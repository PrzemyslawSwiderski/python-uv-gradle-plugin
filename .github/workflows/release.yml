# Workflow triggered when new Release is created.

name: âœ¨ Release

on:
  workflow_dispatch:
  push:
    tags: ["*.*"]

jobs:
  release:
    name: Release Plugin
    runs-on: ubuntu-latest
    steps:
      # Check out current repository
      - name: Fetch Sources
        uses: actions/checkout@v5

      # Set up Java environment for the next steps
      - name: Setup Java
        uses: actions/setup-java@v5
        with:
          distribution: temurin
          java-version: 21

      # Setup Gradle
      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4

      # Publish plugin to Gradle Repository
      - name: Publish Plugin
        run: ./gradlew publishPlugins
        env:
          GRADLE_PUBLISH_KEY: ${{ secrets.GRADLE_PUBLISH_KEY }}
          GRADLE_PUBLISH_SECRET: ${{ secrets.GRADLE_PUBLISH_SECRET }}

  post-release-updates:
    name: Post Release Updates
    permissions:
      contents: write
      pull-requests: write
    needs: [release]
    uses: ./.github/workflows/post-release-updates.yml
    with:
      release-version: ${{ github.ref }}
